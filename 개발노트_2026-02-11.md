# 💇 HairApp 개발 노트 — 2026-02-27 (업데이트)

## 프로젝트 개요
- **목적**: 미용실 고객이 QR코드 접속 → 자기 사진에 헤어스타일 AI 합성
- **기술 스택**: Next.js 15 + TypeScript + Zustand + Vanilla CSS
- **접속 경로**: `http://localhost:3000/salon/demo`
- **AI 모델**: Gemini 2.5 Flash (Image Generation)

---

## Phase 1 완료 — 고객용 페이지

### 플로우
```
스플래시(2초) → 메인(사진업로드 + 스타일선택 + 컬러) → 합성(4단계 진행 UI) → 결과(비교/저장/공유/컬러변경)
```

### 주요 기능
| 기능 | 설명 |
|------|------|
| 사진 업로드 | 파일 선택 + Ctrl+V 클립보드 붙여넣기 |
| 스타일 갤러리 | 여성 15종 + 남성 19종 (Best/Short/Medium/Long/Perm 카테고리) |
| 헤어 컬러 | 11색 프리셋 팔레트 + 강도 슬라이더 (0~100%) |
| AI 합성 | Gemini 2.5 Flash → 서버사이드 API Route (`/api/transform`) |
| 결과 화면 | Before/After 비교, 이미지 저장, 공유 (Web Share API) |
| 실시간 컬러 변경 | Hugging Face SegFormer로 헤어 마스크 추출 → Canvas 실시간 컬러 적용 |
| 다크 모드 | 라이트/다크 토글, localStorage 유지 |
| 관리자 패널 | 로고 5탭 + 비밀번호 → API 통계/히스토리/에러/설정 |

### 컴포넌트 구조
```
src/
├── app/
│   ├── api/
│   │   ├── admin/route.ts        # 관리자 인증 API
│   │   └── transform/route.ts    # AI 합성 API
│   ├── salon/[salonId]/page.tsx  # 고객 메인 페이지
│   └── layout.tsx                # 루트 레이아웃
├── components/
│   ├── AdminPanel/               # 관리자 패널 (통계/히스토리/에러/설정)
│   ├── ColorPalette/             # 컬러 프리셋 선택
│   ├── ColorWheel/               # 컬러 휠
│   ├── LoadingOverlay/           # 로딩 오버레이
│   ├── MainView/                 # 메인 뷰 (사진+스타일+컬러+결과)
│   ├── ResultView/               # 결과 뷰
│   ├── Splash/                   # 스플래시 화면
│   └── ThemeInit.tsx             # 테마 초기화 (FOUC 방지)
├── data/demo.ts                  # 데모 데이터
├── services/
│   ├── geminiHair.ts             # Gemini AI 합성 서비스
│   └── hairColorService.ts       # 헤어 마스크 추출 + 컬러 적용
└── store/useAppStore.ts          # Zustand 상태 관리
```

---

## 2026-02-27 수정 사항

### [FIX] Hydration 에러 수정
- `layout.tsx`: `<html>`, `<body>`에 `suppressHydrationWarning` 추가
- `ThemeInit.tsx`: Zustand persist 저장 형식에 맞게 JSON 파싱 로직 수정

### [FIX] 관리자 비밀번호 보안 강화
- 기존: `if (pw === "1234")` 클라이언트 하드코딩 → 소스 보기로 노출
- 변경: `/api/admin` 서버 API 생성 → `ADMIN_PASSWORD` 환경변수로 검증
- `.env.local`에 `ADMIN_PASSWORD` 추가 (Vercel 배포 시 환경변수 설정 필요)

---

## TODO — 다음 단계

- [ ] Supabase DB 연동 (미용실/스타일/사용기록)
- [ ] 멀티 테넌시 (미용실별 커스텀 UI)
- [ ] API 사용량 제한 (IP/세션 기반 Rate Limit)
- [ ] QR코드 생성 기능
- [ ] PC 관리자 대시보드
- [ ] 커스텀 브랜딩 (미용실별 로고/테마색)
- [ ] 합성 결과 서버 저장
- [ ] `next/image` 최적화
- [ ] 예약 연동 ("이 스타일로 예약" 기능)
